{% extends 'layout.html.twig' %}
{% set active = infos[0].info.sail %}
{% set title = 'Race progress for %boat%'|trans({'%boat%': infos[0].info.skipper}) %}
{% set extra_meta = 'Race progress for %boat%'|trans({'%boat%': infos[0].info.skipper}) %}

{% block container_content %}
    <div class="row-fluid">
        <form method="get" action="/{{ app.request.locale }}/compare">
        <div class="span12 c">
            {{ sail1|raw }}
            {{ sail2|raw }}
            <button type="submit" class="btn" style="margin-bottom: 10px">{{ 'Compare!'|trans }}</button>
        </form>
    </div>
    <div class="row-fluid">
        {% for info in infos %}
        <div class="span3">
            <h3>{{ info.info.skipper }}</h3>
            <dl>
                <dt>{{ 'Boat'|trans }}</dt>
                <dd>{{ info.info.boat }} [{{ info.info.sail }}]</dd>
                <dt>{{ 'Distance traveled / to finish'|trans }}</dt>
                <dd>
                    <div class="progress">
                        <div class="bar" style="width:{{ '%.2f' | format((24016.60-info.info.dtf)/24016.60*100) }}%">
                            {{ 24016.60-info.info.dtf }} <abbr title="{{ 'Nautical Miles'|trans }}">{{ 'nm'|trans }}</abbr>
                        </div>
                        <div class="togo">
                            {{ info.info.dtf }} <abbr title="{{ 'Nautical Miles'|trans }}">{{ 'nm'|trans }}</abbr>
                        </div>
                    </div>
                </dd>
            </dl>
            <p class="tooltips">{{ 'Source'|trans }} : <a target="_blank" href="/{{ app.request.locale }}/json/sail/{{ info.info.sail }}.json" rel="tooltip" data-placement="right" title="{{ 'Download JSON'|trans }}"><i class="icon-download"></i> /json/sail/{{ info.info.sail }}.json</a></p>
        </div>
        <div class="span3">
            <dl>
                <dt>{{ 'Last ranking'|trans }}</dt>
                <dd>{{ info.info.timestamp|date }}</dd>
                <dt>{{ 'Rank'|trans }}</dt>
                <dd>{{ info.info.rank }}</dd>
                <dt>{{ 'Coordinates'|trans }}</dt>
                <dd>{{ info.info.lat_dms }} - {{ info.info.lon_dms }}</dd>
                <dt>{{ 'Heading'|trans }}</dt>
                <dd>{{ info.info['1hour_heading'] }}&deg;</dd>
            </dl>
        </div>
        {% endfor %}
    </div>
    <div class="row-fluid">
        <div class="span6">
            <h3>{{ 'Rank'|trans }}</h3>
            <div id="rank" class="chart"></div>
        </div>
        <div class="span6">
            <h3>{{ 'Distance To Leader'|trans }}</h3>
            <div id="dtl" class="chart"></div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <h3>{{ 'Distance last 24 hours'|trans }}</h3>
            <div id="24hour_distance" class="chart"></div>
        </div>
        <div class="span6">
            <h3>{{ 'Speed last 24 hours'|trans }}</h3>
            <div id="24hour_speed" class="chart"></div>
        </div>
    </div>

    <script type="text/javascript">
    $(function() {
        var data, $rank = $("#rank"), $dtl = $("#dtl"), $24hour_distance = $("#24hour_distance"), $24hour_speed = $("#24hour_speed");
        var options = {
            series: {
                lines: {
                    steps: false
                }
            },
            xaxis: {
                mode: 'time',
                timezone: 'browser'
            },
            yaxis: {
                min: 1,
            },
            legend: {
                backgroundOpacity: 0,
                noColumns: 2
            }
        };

        data = [];
        {% for info in infos %}
        data.push({{ info.dtl|raw }});
        {% endfor %}
        $.plot($dtl, data, options);

        data = [];
        {% for info in infos %}
        data.push({{ info.t24hour_distance|raw }});
        {% endfor %}
        $.plot($24hour_distance, data, options);

        data = [];
        {% for info in infos %}
        data.push({{ info.t24hour_speed|raw }});
        {% endfor %}
        $.plot($24hour_speed, data, options);

        options.yaxis.transform = function (v) { return -v; };
        options.yaxis.tickSize = 2;
        options.yaxis.ticks = 1;
        options.yaxis.max = 20;
        options.series.lines.steps = true;
        data = [];
        {% for info in infos %}
        data.push({{ info.rank|raw }});
        {% endfor %}
        $.plot($rank, data, options);
    });
    </script>
{% endblock %}
